<!DOCTYPE html>
<html lang="en">
    <head>
        <title>deviceorientation</title>
        <meta charset="utf-8">
        <meta name="viewport" content="user-scalable=no, initial-scale=1">
        <style>
            body {
                margin: 0px;
                background-color: #000000;
                overflow: hidden;
            }
            #info {
                position: absolute;
                top: 0px; width: 100%;
                color: #ffffff;
                padding: 5px;
                font-family:Monospace;
                font-size:13px;
                font-weight: bold;
                text-align:center;
                box-sizing: border-box;
            }
            a {
                color: #ff8800;
            }
        </style>
    </head>
    <body>
        <script src="build/three.js"></script>
        <script src="js/controls/DeviceOrientationControls.js"></script>
        <script src="js/WebGL.js"></script>

        <video id="video" autoplay style="display:none"></video>
        
        <script>
            if ( WEBGL.isWebGLAvailable() === false ) {
                document.body.appendChild( WEBGL.getWebGLErrorMessage() );
            }
            
            var camera, scene, renderer, controls ,video;
            init();
            animate();
            function init() {
                camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1100 );
                controls = new THREE.DeviceOrientationControls( camera );
                scene = new THREE.Scene();
                video = document.getElementById( 'video' );
                var texture = new THREE.VideoTexture( video );
                
                scene.background = texture;

                var helperGeometry = new THREE.BoxBufferGeometry( 100, 100, 100, 4, 4, 4 );
                var helperMaterial = new THREE.MeshBasicMaterial( { color: 0xff00ff, wireframe: true } );
                var helper = new THREE.Mesh( helperGeometry, helperMaterial );
        helper.position.set( 130, 100, 100 );
                scene.add( helper );
                

                
                
        	var texture = new THREE.TextureLoader().load( 'textures/fish.png' );
        	var geometry = new THREE.BoxBufferGeometry( 20, 20, 20 );
        	var material = new THREE.MeshBasicMaterial( { map: texture } );
        	mesh = new THREE.Mesh( geometry, material );
        	mesh.position.set( 130, 100, 100 );
        	scene.add( mesh );
		    
		    
		    
		    
                
                
                
                //
                renderer = new THREE.WebGLRenderer( { antialias: true } );
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );
                document.body.appendChild( renderer.domElement );
                //
                window.addEventListener( 'resize', onWindowResize, false );
                
                if ( navigator.mediaDevices && navigator.mediaDevices.getUserMedia ) {
                    var constraints = {
                        video: {
                            //width: 1280, height: 720, facingMode: "user" //使用前鏡頭
                            width: 1280, height: 720, facingMode: { exact: "environment" }//使用後鏡頭
                        }
                    };
                    navigator.mediaDevices.getUserMedia( constraints ).then(
                        function ( stream ) {    
                        // apply the stream to the video element used in the texture
                        video.srcObject = stream;
                        video.play();
                
                
                
                
                        } ).catch( function ( error ) {
                            console.error( 'Unable to access the camera/webcam.', error );
                    } );
                } else {
                    console.error( 'MediaDevices interface not available.' );
                }
            
            
                
                
                
            }
            function animate() {
                window.requestAnimationFrame( animate );
                controls.update();
                renderer.render( scene, camera );
            }
            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }
        </script>
    </body>
</html>
