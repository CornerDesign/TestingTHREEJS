<!DOCTYPE html>
<html lang="en">
<head>
    <title>deviceorientation</title>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1">
    <script src = "https://code.jquery.com/jquery-3.3.1.js"></script>
    <script src="build/three.js"></script>
</head>
<style>
    body {
        margin: 0px;
        background-color: #000000;
        overflow: hidden;
    }
    #container{
        margin: 0px;
        overflow:hidden;
    }
    #Background {
        background-color: #000000;
        background-image:url("textures/BackgroundStar.jpg");
        height: -webkit-fill-available;
        position: absolute;
        top: 0px; width: 100%;
        color: #ffffff;
        padding: 5px;
        font-family:Monospace;
        font-size:13px;
        font-weight: bold;
        text-align:center;
        box-sizing: border-box;
    }
    
    #Main {
        position: absolute;
        top: 100px; width: 100%;
        color: #ffffff;
        padding: 5px;
        font-family:Monospace;
        font-size:13px;
        font-weight: bold;
        text-align:center;
        box-sizing: border-box;
        z-index = 1;
    }
    
    #Tutorial {
        position: absolute;
        top: 100px; width: 100%;
        color: white;
        padding: 5px;
        font-family:Monospace;
        font-size:13px;
        font-weight: bold;
        text-align:center;
        box-sizing: border-box;
        z-index = 1;
    }
    
    #EndingGame {
        position: absolute;
        top: 100px; width: 100%;
        color: white;
        padding: 5px;
        font-family:Monospace;
        font-size:13px;
        font-weight: bold;
        text-align:center;
        box-sizing: border-box;
        z-index = 1;
    }
    
    a {
        color: #ff8800;
    }
        
    .mybtn {
        background-color: rgba(0, 0, 0, 0);
        border: 2px solid;
        color: white;
        padding: 15px;
        width: 150 px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        font-weight: bold;
        letter-spacing:2px;
        margin: 4px 10px;  
        -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
        cursor: pointer;  
    }

    .clickmybtn {
        background-color: rgba(0, 0, 0, 0);
        color: #e6e6e6;
        border: 2px solid #e6e6e6;
    }

    .clickmybtn:hover {
        background-color: #e6e6e6;
        border: 2px solid #e6e6e6;
        color: #1a1a1a;
    }
</style>
<body>
    <div id = "container">
        <div id="Background">
        </div>
        
        <div id="Main">
            <h1>台 灣 萊 雅</h1>
            <h1>Find your power stone</h1>
            <h2>尋找你的能力寶石</h2>
            <button class ="mybtn clickmybtn" onclick="LanguageFunction(1)"> 繁體中文 </button>
            <button class ="mybtn clickmybtn" onclick="LanguageFunction(2)"> English </button>
        </div>
        
        <div id="Tutorial">
            <img id = "tutorialimg " src="textures/phoneturn.png" alt="tutorial" width="100" > <br/>
            <h3 id = "tutorialtext">旋轉手機尋找能力寶石</h3>
        </div>
        
        <div id="EndingGame">
            <h1 id = "Endtext ">恭喜你找到所有能力寶石</h1>
            <h2 id = "Endtext2 ">Congraulation</h2>
            <button class ="mybtn clickmybtn" onclick="location.href='https://www.google.com.tw'"> 填問卷去 </button>
        </div>
        
        <div id="Debug">
            <p id="Counting"></p>
        </div>    
    </div>
        
    <script src="build/three.js"></script>
    <script src="js/ar.js"></script>
    <script src="js/controls/DeviceOrientationControls.js"></script>
    <script src="js/WebGL.js"></script>
    <script src="js/threex.domevents.js"></script>
    <script src="js/TweenMax.min.js"></script>
    <script src="js/GLTFLoader.js"></script>
    <script src="js/OBJLoader.js"></script>
    <script src="js/MTLLoader.js"></script>

<script>
    Tutorial.style.display = "none";
    EndingGame.style.display = "none";
    TweenMax.from("#Background", 0.5 , { y:-5,opacity:0 ,delay:1});
    TweenMax.from("#Main", 0.5 , { y:-5,opacity:0 ,delay:1.25});
    var StartGame = false;
    var CountNumber = 0 ;
    var Language = "Chinese";
    
    function LanguageFunction(language){
        Tutorial.style.display = "block";
        if(language == 1){
            Language = "Chinese";
            document.getElementById("tutorialtext").innerHTML = "旋轉手機尋找能力寶石" ;
            console.log("chinese");
        }if(language == 2){
            Language = "English";
            document.getElementById("tutorialtext").innerHTML = "Turn your Phone to find power stone" ;
            console.log("English");
        }
        StartGamefunction();
    }
    
    function StartGamefunction(){
        StartGame = true;
        TweenMax.to("#Background", 0.5 , { y:-5,opacity:0});
        TweenMax.to("#Main", 0.5 , { y:-5,opacity:0,delay:0.25});
        
        TweenMax.from("#Tutorial", 0.5 , { y:-5,opacity:0 ,delay:1} );
        TweenMax.to("#Tutorial", 0.5 , { opacity:0 ,delay:5} );
        init();
        animate();
        var domEvents = new THREEx.DomEvents(camera, renderer.domElement);
        domEvents.addEventListener(scene.getObjectByName("Diamond1cube"), 'touchstart' , event =>{
            infoanim("R1");
        })
        domEvents.addEventListener(scene.getObjectByName("Diamond2cube"), 'touchstart' , event =>{
            infoanim("R2");
        })
        domEvents.addEventListener(scene.getObjectByName("Diamond1cube"), 'touchstart' , event =>{
            infoanim("R1");
        })
        domEvents.addEventListener(scene.getObjectByName("Diamond2cube"), 'touchstart' , event =>{
            infoanim("R2");
        })
        domEvents.addEventListener(scene.getObjectByName("Diamond1cube"), 'touchstart' , event =>{
            infoanim("R1");
        })
    }
    var camera, scene, renderer, controls;
    
    function init(){
        // init renderer
        renderer = new THREE.WebGLRenderer({
            antialias: true,
            alpha: true
        });
        renderer.setClearColor(new THREE.Color('lightgrey'), 0)
        renderer.setSize( 640, 480 );
        renderer.domElement.style.position = 'absolute'
        renderer.domElement.style.top = '0px'
        renderer.domElement.style.left = '0px'
        document.body.appendChild( renderer.domElement );
        // array of functions for the rendering loop
        var onRenderFcts= [];
        // init scene and camera
        scene = new THREE.Scene();
   
        //Create a camera
        camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 1100 );
        controls = new THREE.DeviceOrientationControls( camera );
        scene.add(camera);
    
        //handle arToolkitSource
        var arToolkitSource = new THREEx.ArToolkitSource({
            sourceType : 'webcam',        
        })
        
        arToolkitSource.init(function onReady(){
            onResize()
        })
    
        // handle resize
        window.addEventListener('resize', function(){
            onResize()
        })
        
        function onResize(){
            arToolkitSource.onResize()    
            arToolkitSource.copySizeTo(renderer.domElement)    
            if( arToolkitContext.arController !== null ){
                arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)    
        }    
    }
        
    //initialize arToolkitContext
    // create atToolkitContext
    var arToolkitContext = new THREEx.ArToolkitContext({
        cameraParametersUrl: THREEx.ArToolkitContext.baseURL + '../data/data/camera_para.dat',
        detectionMode: 'mono',
    })
    // initialize it
    arToolkitContext.init(function onCompleted(){
        // copy projection matrix to camera
        camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
    })
    // update artoolkit on every frame
    onRenderFcts.push(function(){
        if( arToolkitSource.ready === false )    return
        arToolkitContext.update( arToolkitSource.domElement )
        
        // update scene.visible if the marker is seen
        scene.visible = camera.visible
    })
        
    //////////////////////////////////////////////////////////////////////////////////
    //        add an object in the scene
    /*    
    var texture = new THREE.TextureLoader().load( 'textures/fish.png' );
        var geometry = new THREE.PlaneGeometry( 50,50);
        var material = new THREE.MeshBasicMaterial( { map: texture } );
        planemesh = new THREE.Mesh( geometry, material );
        
        //planemesh.rotation.y = 90 ;
        planemesh.position.set( 100, 50, 0 );
        planemesh.lookAt( camera.position );
        scene.add( planemesh );
        
        var texture = new THREE.TextureLoader().load( 'textures/fish.png' );
        var geometry = new THREE.PlaneGeometry( 50,50);
        var material = new THREE.MeshBasicMaterial( { map: texture } );
        planemesh2 = new THREE.Mesh( geometry, material );
        //planemesh2.rotation.y = 90 ;
        planemesh2.position.set( -100,0, 100 );
        planemesh2.lookAt( camera.position );
        scene.add( planemesh2 );
      */  

        var ColorArray = new Array();
        ColorArray[0] = '0xff0000';
        ColorArray[1] = '0x00FF00';
        ColorArray[2] = '0x0000FF';
        ColorArray[3] = '0x6600ff';
        ColorArray[4] = '0xffff00';
        
        var NameArray = new Array();
        NameArray[0] = 'DiamondR1';
        NameArray[1] = 'DiamondG1';
        NameArray[2] = 'DiamondB1';
        NameArray[3] = 'DiamondP1';
        NameArray[4] = 'DiamondY1';

        
        AddNewModel( NameArray[0] , ColorArray[0] ,-100,0,-50);
        AddNewModel( NameArray[1] , ColorArray[1] ,-100,0,-25);
        AddNewModel( NameArray[2] , ColorArray[2] ,-100,0,0);
        AddNewModel( NameArray[3] , ColorArray[3] ,-100,0,25);
        AddNewModel( NameArray[4] , ColorArray[4] ,-100,0,50);
        
    //Add a light

    var light = new THREE.DirectionalLight( 0xffffff );
    light.position.set( 1, 1, 1 );
    scene.add( light );
    var light = new THREE.DirectionalLight( 0x002288 );
    light.position.set( -1, -1, -1 );
    scene.add( light );
    var light = new THREE.AmbientLight( 0x222222 );
    scene.add( light );
        
    window.addEventListener( 'resize', onWindowResize, false );    
}
    //////////////////////////////////////////////////////////////////////////////////     
    function animate() {
                window.requestAnimationFrame( animate );
                controls.update();
                renderer.render( scene, camera );
            }
    
   function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize( window.innerWidth, window.innerHeight );
            }
   //生成model
    function AddNewModel( MeshName , ModelColor , x , y , z){
        var loader = new THREE.OBJLoader()
        loader.load( 'model/Diamond.obj', function ( object ) {
            object.traverse( function ( child ) {
                if ( child instanceof THREE.Mesh ) {
                    child.material.color.setHex(ModelColor);
                }
            }
        );
        scene.add( object );
        object.scale.set(0.5,0.5,0.5);
        object.name = MeshName;     
        object.position.set(x,y,z);
        console.log("Name"+object.name +"Color"+ ModelColor + "object.position"+object.position.y);
        });

        var cubegeometry = new THREE.BoxGeometry( 20 , 15 , 15 );
        var cubematerial = new THREE.MeshBasicMaterial( {  color: 0xFFF000,  transparent : true,  opacity:0.1 });
        var cubemesh = new THREE.Mesh( cubegeometry, cubematerial );
        cubemesh.position.set(x,y+5,z) ;
        scene.add( cubemesh );
        cubemesh.name = MeshName+"cube";
        console.log("cubeName"+cubemesh.name);
    }

    //要出現的資訊        
    function infoanim(DName){
        if(DName == "R1"){
            this.R1 = new TimelineMax();
            DiamondR1cube = scene.getObjectByName("DiamondR1cube"); 
            this.R1.to(DiamondR1cube.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
            //定義寶石名稱
            DiamondR1 = scene.getObjectByName("DiamondR1"); 
            //寶石消失
            this.R1.to(DiamondR1.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut},"-=0.5");
            
            var texture = new THREE.TextureLoader().load( 'textures/fish.png' );
            var geometry = new THREE.PlaneGeometry( 50,50);
            var material = new THREE.MeshBasicMaterial( { map: texture } );
            DiamondR1info = new THREE.Mesh( geometry, material );
            DiamondR1info.position.x = DiamondR1.position.x;
            DiamondR1info.position.y = DiamondR1.position.y;
            DiamondR1info.position.z = DiamondR1.position.z;           
            DiamondR1info.lookAt( camera.position );
            scene.add( DiamondR1info );
            this.R1.from(DiamondR1info.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
        }
        if(DName == "G1"){
            this.G1 = new TimelineMax();
            DiamondG1cube = scene.getObjectByName("DiamondG1cube"); 
            this.G1.to(DiamondG1cube.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
            //定義寶石名稱
            DiamondG1 = scene.getObjectByName("DiamondG1"); 
            //寶石消失
            this.G1.to(DiamondG1.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut},"-=0.5");
            
            var texture = new THREE.TextureLoader().load( 'textures/redpeople.png' );
            var geometry = new THREE.PlaneGeometry( 50,50);
            var material = new THREE.MeshBasicMaterial( { map: texture } );
            DiamondG1info = new THREE.Mesh( geometry, material );
            DiamondG1info.position.x = DiamondG1.position.x;
            DiamondG1info.position.y = DiamondG1.position.y;
            DiamondG1info.position.z = DiamondG1.position.z;            
            DiamondG1info.lookAt( camera.position );
            scene.add( DiamondG1info );
            this.G1.from(DiamondG1info.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
        }
        if(DName == "B1"){
            this.B1 = new TimelineMax();
            DiamondB1cube = scene.getObjectByName("DiamondB1cube"); 
            this.B1.to(DiamondB1cube.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
            //定義寶石名稱
            DiamondB1 = scene.getObjectByName("DiamondB1"); 
            //寶石消失
            this.B1.to(DiamondB1.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut},"-=0.5");
            
            var texture = new THREE.TextureLoader().load( 'textures/redpeople.png' );
            var geometry = new THREE.PlaneGeometry( 50,50);
            var material = new THREE.MeshBasicMaterial( { map: texture } );
            DiamondB1cubeinfo = new THREE.Mesh( geometry, material );
            DiamondB1cubeinfo.position.x = DiamondB1.position.x;
            DiamondB1cubeinfo.position.y = DiamondB1.position.y;
            DiamondB1cubeinfo.position.z = DiamondB1.position.z;            
            DiamondB1cubeinfo.lookAt( camera.position );
            scene.add( DiamondB1cubeinfo );
            this.B1.from(DiamondB1cubeinfo.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
        }
        if(DName == "P1"){
            this.P1 = new TimelineMax();
            DiamondP1cube = scene.getObjectByName("DiamondP1cube"); 
            this.P1.to(DiamondP1cube.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
            //定義寶石名稱
            DiamondP1 = scene.getObjectByName("DiamondP1cube"); 
            //寶石消失
            this.P1.to(DiamondP1.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut},"-=0.5");
            
            var texture = new THREE.TextureLoader().load( 'textures/redpeople.png' );
            var geometry = new THREE.PlaneGeometry( 50,50);
            var material = new THREE.MeshBasicMaterial( { map: texture } );
            DiamondP1cubeinfo = new THREE.Mesh( geometry, material );
            DiamondP1cubeinfo.position.x = DiamondP1.position.x;
            DiamondP1cubeinfo.position.y = DiamondP1.position.y;
            DiamondP1cubeinfo.position.z = DiamondP1.position.z;            
            DiamondP1cubeinfo.lookAt( camera.position );
            scene.add( DiamondP1cubeinfo );
            this.P1.from(DiamondP1cubeinfo.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
        }
        if(DName == "Y1"){
            this.Y1 = new TimelineMax();
            Diamond5cube = scene.getObjectByName("Diamond5cube"); 
            this.Y1.to(Diamond5cube.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
            //定義寶石名稱
            Diamond5 = scene.getObjectByName("Diamond5"); 
            //寶石消失
            this.Y1.to(Diamond5.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut},"-=0.5");
            
            var texture = new THREE.TextureLoader().load( 'textures/redpeople.png' );
            var geometry = new THREE.PlaneGeometry( 50,50);
            var material = new THREE.MeshBasicMaterial( { map: texture } );
            infored = new THREE.Mesh( geometry, material );
            infored.position.x = Diamond5.position.x;
            infored.position.y = Diamond5.position.y;
            infored.position.z = Diamond5.position.z;            
            infored.lookAt( camera.position );
            scene.add( infored );
            this.Y1.from(infored.scale, 0.5 , { x:0 , y:0 , z:0 , ease:Expo.easeOut});
        }
        EndGameCountDown();
    }
    
    function EndGameCountDown(){  
        CountNumber++;
        document.getElementById("Counting").innerHTML = CountNumber;
        if(CountNumber >= 2){
            controls.enable = false;
            document.getElementById("Background").style.display = "block";
            TweenMax.to("#Background", 0.5 , { y:0,opacity:1});
            document.getElementById("EndingGame").style.display = "block";
            var EndGameAnim = new TimelineLite();
            EndGameAnim.to("#EndingGame", 0.5 , { y:0,opacity:1 ,onComplete: function() {
               renderer.domElement.style.top = '600px';
                    }})
         }    
     }
        </script>
    </body>
</html>
